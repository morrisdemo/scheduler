<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Service Order Scheduler - SAPUI5</title>
  <script
    id="sap-ui-bootstrap"
    src="https://sdk.openui5.org/resources/sap-ui-core.js"
    data-sap-ui-theme="sap_horizon"
    data-sap-ui-libs="sap.m"
    data-sap-ui-async="false"
  ></script>
</head>
<body class="sapUiBody">
  <div id="content"></div>
  <script>
    sap.ui.getCore().attachInit(function () {
      const orderTypes = [
        "Meter Investigation",
        "Turn Off Meter",
        "Turn On Meter",
        "Meter Read",
        "Meter/Equipment Install"
      ];

      const divisions = ["Electric", "Gas", "Water"];

      const criticalityMap = {
        "Monday-Morning": "High",
        "Wednesday-Afternoon": "High",
        "Thursday-Evening": "Medium",
        "Friday-Afternoon": "Medium"
      };

      let selectedDay = "";
      let selectedSlot = "";
      let selectedOrderType = "";
      let selectedDivision = "";

      const slotTable = new sap.m.Table({
        columns: [
          new sap.m.Column({ header: new sap.m.Label({ text: "Day" }) }),
          new sap.m.Column({ header: new sap.m.Label({ text: "Slot" }) }),
          new sap.m.Column({ header: new sap.m.Label({ text: "Time Range" }) }),
          new sap.m.Column({ header: new sap.m.Label({ text: "Criticality" }) }),
          new sap.m.Column({ header: new sap.m.Label({ text: "Action" }) })
        ],
        visible: false,
        growing: true
      });

      const orderTypeSelect = new sap.m.Select({
        width: "100%",
        change: function (oEvent) {
          selectedOrderType = oEvent.getParameter("selectedItem").getKey();
          updateButtonsVisibility();
        }
      });
      orderTypes.forEach(t => orderTypeSelect.addItem(new sap.ui.core.Item({ key: t, text: t })));

      const divisionSelect = new sap.m.Select({
        width: "100%",
        change: function (oEvent) {
          selectedDivision = oEvent.getParameter("selectedItem").getKey();
          updateButtonsVisibility();
        }
      });
      divisions.forEach(d => divisionSelect.addItem(new sap.ui.core.Item({ key: d, text: d })));

      const autoScheduleBtn = new sap.m.Button({
        text: "Auto-Schedule Order",
        type: "Emphasized",
        visible: false,
        press: function () {
          sap.m.MessageToast.show(`✅ Order scheduled for ${selectedOrderType} - ${selectedDivision}. Customer will be notified of assigned timeslot.`);
        }
      });

      const viewSlotsBtn = new sap.m.Button({
        text: "View Timeslots",
        type: "Default",
        visible: false,
        press: function () {
          buildTimeslotTable();
          slotTable.setVisible(true);
        }
      });

      const submitBtn = new sap.m.Button({
        text: "Submit Appointment",
        type: "Accept",
        visible: false,
        press: function () {
          if (!selectedDay || !selectedSlot) {
            sap.m.MessageToast.show("⚠️ Please select a timeslot.");
            return;
          }
          sap.m.MessageToast.show(`✅ Appointment confirmed: ${selectedDay} ${selectedSlot}`);
        }
      });

      function updateButtonsVisibility() {
        const ready = selectedOrderType && selectedDivision;
        autoScheduleBtn.setVisible(ready);
        viewSlotsBtn.setVisible(ready);
      }

      function buildTimeslotTable() {
        slotTable.removeAllItems();
        const days = ["Monday","Tuesday","Wednesday","Thursday","Friday"];
        const slots = [
          { name: "Morning", range: "8:00–12:00" },
          { name: "Afternoon", range: "12:00–4:00" },
          { name: "Evening", range: "4:00–8:00" }
        ];

        days.forEach(day => {
          slots.forEach(slot => {
            const code = `${day}-${slot.name}`;
            const crit = criticalityMap[code] || "Low";
            const row = new sap.m.ColumnListItem({
              cells: [
                new sap.m.Text({ text: day }),
                new sap.m.Text({ text: slot.name }),
                new sap.m.Text({ text: slot.range }),
                new sap.m.ObjectStatus({
                  text: crit,
                  state: crit === "High" ? "Error" : crit === "Medium" ? "Warning" : "Success"
                }),
                new sap.m.Button({
                  text: "Select",
                  press: function () {
                    selectedDay = day;
                    selectedSlot = `${slot.name} (${slot.range})`;
                    submitBtn.setVisible(true);
                    sap.m.MessageToast.show(`Selected: ${day} ${selectedSlot}`);
                  }
                })
              ]
            });
            slotTable.addItem(row);
          });
        });
      }

      const page = new sap.m.Page({
        title: "Schedule Service Order",
        content: [
          new sap.m.Panel({
            headerText: "Service Details",
            content: [
              new sap.m.HBox({
                items: [
                  new sap.m.VBox({
                    width: "100%",
                    items: [new sap.m.Label({ text: "Order Type" }), orderTypeSelect]
                  }),
                  new sap.m.VBox({
                    width: "100%",
                    items: [new sap.m.Label({ text: "Division" }), divisionSelect]
                  })
                ]
              })
            ]
          }),
          new sap.m.HBox({
            alignItems: "Center",
            justifyContent: "SpaceBetween",
            items: [autoScheduleBtn, viewSlotsBtn]
          }),
          new sap.m.Panel({
            headerText: "Available Timeslots",
            content: [slotTable]
          }),
          submitBtn
        ]
      });

      new sap.m.App({ pages: [page] }).placeAt("content");
    });
  </script>
</body>
</html>
